<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gaga.bo.service.admin.AdminDao">

	<resultMap id="noticePostResult" type="noticePost">
		<id property="noticePostNo" column="notice_post_no"
			jdbcType="INTEGER" />
		<result property="noticePostCategoryNo"
			column="notice_post_category_no" jdbcType="INTEGER" />
		<result property="noticePostTitle" column="notice_post_title"
			jdbcType="LONGVARCHAR" />
		<result property="noticePostText" column="notice_post_text"
			jdbcType="LONGVARCHAR" />
		<result property="noticePostImg" column="notice_post_img"
			jdbcType="LONGVARCHAR" />
		<result property="noticePostRegDate"
			column="notice_post_reg_date" jdbcType="TIMESTAMP" />
		<result property="userNo" column="user_no" jdbcType="INTEGER" />
	</resultMap>

	<!-- 블랙리스트용 -->
	<resultMap id="userResultMap" type="user">
		<result property="userNo" column="user_no" jdbcType="INTEGER" />
		<result property="userId" column="user_id" jdbcType="VARCHAR" />
		<result property="password" column="password"
			jdbcType="VARCHAR" />
		<result property="userName" column="user_name"
			jdbcType="VARCHAR" />
		<result property="birthday" column="birthday" jdbcType="DATE" />
		<result property="gender" column="gender" jdbcType="INTEGER" />
		<result property="nickName" column="nick_name"
			jdbcType="VARCHAR" />
		<result property="phoneNo" column="phone_no" jdbcType="INTEGER" />
		<result property="role" column="role" jdbcType="INTEGER" />
		<result property="joinDay" column="join_day"
			jdbcType="TIMESTAMP" />
		<result property="temperature" column="temperature"
			jdbcType="REAL" />
		<result property="outDay" column="out_day" jdbcType="TIMESTAMP" />
		<result property="outReason" column="out_reason"
			jdbcType="LONGVARCHAR" />
		<result property="profileImg" column="profile_img"
			jdbcType="LONGVARCHAR" />
		<result property="activityImg" column="activity_img"
			jdbcType="LONGVARCHAR" />
		<result property="activityImg2" column="activity_img2"
			jdbcType="LONGVARCHAR" />
		<result property="activityImg3" column="activity_img3"
			jdbcType="LONGVARCHAR" />
		<result property="userIntro" column="user_intro"
			jdbcType="LONGVARCHAR" />
		<result property="mainTitleNo" column="main_title_no"
			jdbcType="INTEGER" />
		<result property="bankCode" column="bank_code"
			jdbcType="VARCHAR" />
		<result property="bankName" column="bank_name"
			jdbcType="VARCHAR" />
		<result property="accountNo" column="account_no"
			jdbcType="VARCHAR" />
		<result property="blacklist" column="blacklist"
			jdbcType="INTEGER" />
		<result property="filterGender" column="filter_gender"
			jdbcType="INTEGER" />
		<result property="filterMaxAge" column="filter_max_age"
			jdbcType="INTEGER" />
		<result property="filterMinAge" column="filter_min_age"
			jdbcType="INTEGER" />
		<result property="filterTag" column="filter_tag"
			jdbcType="LONGVARCHAR" />
		<result property="filterTag2" column="filter_tag2"
			jdbcType="LONGVARCHAR" />
		<result property="filterTag3" column="filter_tag3"
			jdbcType="LONGVARCHAR" />
	</resultMap>

	<resultMap id="reportResultMap" type="report">
		<id column="report_no" property="reportNo" jdbcType="INTEGER" />
		<result column="reporting_no" property="reportingNo"
			jdbcType="INTEGER" />
		<result column="reported_no" property="reportedNo"
			jdbcType="INTEGER" />
		<result column="report_category_no" property="reportCategoryNo"
			jdbcType="INTEGER" />
		<result column="report_content" property="reportContent"
			jdbcType="VARCHAR" />
		<result column="report_date" property="reportDate"
			jdbcType="TIMESTAMP" />
		<result column="report_img" property="reportImg"
			jdbcType="VARCHAR" />
		<result column="report_img2" property="reportImg2"
			jdbcType="VARCHAR" />
		<result column="report_img3" property="reportImg3"
			jdbcType="VARCHAR" />
		<result column="user_id" property="userId" jdbcType="VARCHAR" />
	</resultMap>

	<!-- 관리자게시판 -->
	<insert id="addNoticePost"
		parameterType="com.gaga.bo.service.domain.NoticePost">
		INSERT INTO notice_posts (
		notice_post_category_no,
		notice_post_title,
		notice_post_text,
		notice_post_img,
		notice_post_reg_date,
		user_no
		)
		VALUES (
		#{noticePostCategoryNo:INTEGER},
		#{noticePostTitle:LONGVARCHAR},
		#{noticePostText:LONGVARCHAR},
		#{noticePostImg:LONGVARCHAR},
		now(),
		#{userNo:INTEGER}
		)
	</insert>



	<select id="getNoticePostList" resultMap="noticePostResult">
		SELECT * FROM
		notice_posts
	</select>

	<select id="getNoticePostListByCategoryNo"
		resultMap="noticePostResult">
		SELECT * FROM
		notice_posts 
		where notice_post_Category_no =
		#{noticePostCategoryNo}
	</select>

	<select id="searchNoticePost" resultMap="noticePostResult">
		SELECT * FROM
		notice_posts
		WHERE notice_post_title LIKE CONCAT('%', #{keyword}, '%')
		OR notice_post_text LIKE CONCAT('%', #{keyword}, '%')
	</select>

	<select id="getNoticePost" resultMap="noticePostResult">
		SELECT * FROM notice_posts
		WHERE notice_post_no = #{noticePostNo}
	</select>

	<update id="updateNoticePost"
		parameterType="com.gaga.bo.service.domain.NoticePost">
		UPDATE notice_posts
		SET notice_post_category_no =
		#{noticePostCategoryNo},
		notice_post_title = #{noticePostTitle},
		notice_post_text = #{noticePostText},
		notice_post_img =
		#{noticePostImg}
		WHERE notice_post_no = #{noticePostNo}
	</update>

	<delete id="deleteNoticePost">
		DELETE FROM notice_posts WHERE notice_post_no =
		#{noticePostNo}
	</delete>

	<!-- 블랙리스트 CRUD -->

	<insert id="addBlackList"
		parameterType="com.gaga.bo.service.domain.User">
		UPDATE users
		SET blacklist = 1
		WHERE user_no = #{userNo}
	</insert>

	<select id="getBlackList" resultMap="userResultMap">
		SELECT *
		FROM users
		WHERE
		blacklist != 0 AND user_no = #{userNo}
	</select>

	<select id="getBlackListList" resultMap="userResultMap">
		SELECT *
		FROM users
		WHERE
		blacklist != 0
	</select>

	<insert id="deleteBlackList"
		parameterType="com.gaga.bo.service.domain.User">
		UPDATE users
		SET blacklist = 0
		WHERE user_no = #{userNo}
	</insert>

	<!-- 신고조회 CRUD -->

	<select id="getReportAdmin" resultMap="reportResultMap">
		SELECT
		r.reported_no,
		r.reporting_no, r.report_category_no, r.report_date,
		r.report_content,
		r.report_img, r.report_img2, r.report_img3, u.user_id, u.user_name
		FROM reports r
		INNER JOIN users u ON r.reported_no = u.user_no
		WHERE
		r.reported_no = #{reportedNo}
	</select>

	<select id="getReportAdminList" resultMap="reportResultMap">
		SELECT
		r.report_category_no, r.reported_no, r.report_date, u.user_id
		FROM
		reports r
		INNER JOIN users u ON r.reported_no = u.user_no
	</select>
</mapper>